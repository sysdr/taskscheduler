<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Scheduler - Day 6: Task Definition Model</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(45deg, #2196F3, #21CBF3); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .content { padding: 30px; }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
        }
        .stat-card h3 { font-size: 2rem; margin-bottom: 5px; }
        .stat-card p { opacity: 0.9; }
        .section { margin-bottom: 30px; }
        .section h2 { color: #333; margin-bottom: 15px; border-bottom: 2px solid #2196F3; padding-bottom: 5px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 14px; 
        }
        .form-group textarea { height: 100px; resize: vertical; }
        .btn { 
            background: linear-gradient(45deg, #2196F3, #21CBF3); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px; 
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .btn-danger { background: linear-gradient(45deg, #f44336, #ff5722); }
        .btn-success { background: linear-gradient(45deg, #4caf50, #8bc34a); }
        .btn-warning { background: linear-gradient(45deg, #ff9800, #ffc107); }
        .task-list { max-height: 400px; overflow-y: auto; }
        .task-item { 
            background: #f8f9fa; 
            border-left: 4px solid #2196F3; 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 5px; 
        }
        .task-item h4 { color: #333; margin-bottom: 5px; }
        .task-item p { color: #666; margin-bottom: 5px; }
        .task-status { 
            display: inline-block; 
            padding: 3px 8px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: bold; 
            text-transform: uppercase; 
        }
        .status-active { background: #4caf50; color: white; }
        .status-paused { background: #ff9800; color: white; }
        .status-failed { background: #f44336; color: white; }
        .status-completed { background: #9c27b0; color: white; }
        .priority-high { border-left-color: #f44336; }
        .priority-medium { border-left-color: #ff9800; }
        .priority-low { border-left-color: #4caf50; }
        .error { color: #f44336; margin-top: 10px; }
        .success { color: #4caf50; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Task Scheduler</h1>
            <p>Day 6: Task Definition Model</p>
        </div>
        
        <div class="content">
            <!-- Statistics Section -->
            <div class="section">
                <h2>üìä Task Statistics</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <h3 id="totalTasks">0</h3>
                        <p>Total Tasks</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="activeTasks">0</h3>
                        <p>Active Tasks</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="pausedTasks">0</h3>
                        <p>Paused Tasks</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="failedTasks">0</h3>
                        <p>Failed Tasks</p>
                    </div>
                </div>
            </div>
            
            <!-- Create Task Section -->
            <div class="section">
                <h2>‚ûï Create New Task</h2>
                <form id="createTaskForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="form-group">
                                <label for="taskName">Task Name</label>
                                <input type="text" id="taskName" required placeholder="e.g., Daily Report Generation">
                            </div>
                            <div class="form-group">
                                <label for="taskType">Task Type</label>
                                <select id="taskType" required>
                                    <option value="">Select Type</option>
                                    <option value="EMAIL_TASK">Email Task</option>
                                    <option value="REPORT_TASK">Report Task</option>
                                    <option value="CLEANUP_TASK">Cleanup Task</option>
                                    <option value="DATA_SYNC_TASK">Data Sync Task</option>
                                    <option value="NOTIFICATION_TASK">Notification Task</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cronExpression">CRON Expression</label>
                                <input type="text" id="cronExpression" required placeholder="0 0 9 * * ?">
                                <small>Daily at 9 AM: 0 0 9 * * ?</small>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="priority">Priority (1-10)</label>
                                <input type="number" id="priority" min="1" max="10" value="5" required>
                            </div>
                            <div class="form-group">
                                <label for="timeoutSeconds">Timeout (seconds)</label>
                                <input type="number" id="timeoutSeconds" min="1" value="300" required>
                            </div>
                            <div class="form-group">
                                <label for="payload">Payload (JSON)</label>
                                <textarea id="payload" placeholder='{"key": "value"}'></textarea>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn">Create Task</button>
                </form>
                <div id="createMessage"></div>
            </div>
            
            <!-- Tasks List Section -->
            <div class="section">
                <h2>üìã Task Definitions</h2>
                <div style="margin-bottom: 15px;">
                    <button class="btn" onclick="loadAllTasks()">üîÑ Refresh</button>
                    <button class="btn btn-success" onclick="loadEligibleTasks()">‚ö° Eligible Tasks</button>
                    <button class="btn btn-warning" onclick="loadHighPriorityTasks()">üî• High Priority</button>
                    <button class="btn btn-danger" onclick="loadFailedTasks()">‚ùå Failed Tasks</button>
                </div>
                <div class="task-list" id="tasksList">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/tasks';
        
        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const stats = await response.json();
                
                document.getElementById('totalTasks').textContent = stats.totalTasks;
                document.getElementById('activeTasks').textContent = stats.activeTasks;
                document.getElementById('pausedTasks').textContent = stats.pausedTasks;
                document.getElementById('failedTasks').textContent = stats.failedTasks;
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }
        
        // Load all tasks
        async function loadAllTasks() {
            try {
                const response = await fetch(API_BASE);
                const tasks = await response.json();
                displayTasks(tasks);
                loadStatistics();
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }
        
        // Load eligible tasks
        async function loadEligibleTasks() {
            try {
                const response = await fetch(`${API_BASE}/eligible`);
                const tasks = await response.json();
                displayTasks(tasks);
            } catch (error) {
                console.error('Error loading eligible tasks:', error);
            }
        }
        
        // Load high priority tasks
        async function loadHighPriorityTasks() {
            try {
                const response = await fetch(`${API_BASE}/high-priority`);
                const tasks = await response.json();
                displayTasks(tasks);
            } catch (error) {
                console.error('Error loading high priority tasks:', error);
            }
        }
        
        // Load failed tasks
        async function loadFailedTasks() {
            try {
                const response = await fetch(`${API_BASE}/failed`);
                const tasks = await response.json();
                displayTasks(tasks);
            } catch (error) {
                console.error('Error loading failed tasks:', error);
            }
        }
        
        // Display tasks
        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No tasks found</p>';
                return;
            }
            
            tasksList.innerHTML = tasks.map(task => {
                const priorityClass = task.priority >= 8 ? 'priority-high' : 
                                    task.priority >= 5 ? 'priority-medium' : 'priority-low';
                
                return `
                    <div class="task-item ${priorityClass}">
                        <h4>${task.name}</h4>
                        <p><strong>Type:</strong> ${task.taskType} | 
                           <strong>Priority:</strong> ${task.priority} | 
                           <strong>Timeout:</strong> ${task.timeoutSeconds}s</p>
                        <p><strong>CRON:</strong> ${task.cronExpression}</p>
                        <p><strong>Next Run:</strong> ${task.nextRunTime || 'Not scheduled'}</p>
                        <p><strong>Status:</strong> <span class="task-status status-${task.status.toLowerCase()}">${task.status}</span></p>
                        <div style="margin-top: 10px;">
                            <button class="btn" onclick="pauseTask('${task.id}')">‚è∏Ô∏è Pause</button>
                            <button class="btn btn-success" onclick="resumeTask('${task.id}')">‚ñ∂Ô∏è Resume</button>
                            <button class="btn btn-warning" onclick="completeTask('${task.id}')">‚úÖ Complete</button>
                            <button class="btn btn-danger" onclick="failTask('${task.id}')">‚ùå Fail</button>
                            <button class="btn btn-danger" onclick="deleteTask('${task.id}')">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Task actions
        async function pauseTask(id) {
            try {
                await fetch(`${API_BASE}/${id}/pause`, { method: 'POST' });
                loadAllTasks();
            } catch (error) {
                console.error('Error pausing task:', error);
            }
        }
        
        async function resumeTask(id) {
            try {
                await fetch(`${API_BASE}/${id}/resume`, { method: 'POST' });
                loadAllTasks();
            } catch (error) {
                console.error('Error resuming task:', error);
            }
        }
        
        async function completeTask(id) {
            try {
                await fetch(`${API_BASE}/${id}/complete`, { method: 'POST' });
                loadAllTasks();
            } catch (error) {
                console.error('Error completing task:', error);
            }
        }
        
        async function failTask(id) {
            try {
                await fetch(`${API_BASE}/${id}/fail`, { method: 'POST' });
                loadAllTasks();
            } catch (error) {
                console.error('Error failing task:', error);
            }
        }
        
        async function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                try {
                    await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
                    loadAllTasks();
                } catch (error) {
                    console.error('Error deleting task:', error);
                }
            }
        }
        
        // Create task form submission
        document.getElementById('createTaskForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const taskData = {
                name: document.getElementById('taskName').value,
                taskType: document.getElementById('taskType').value,
                cronExpression: document.getElementById('cronExpression').value,
                priority: parseInt(document.getElementById('priority').value),
                timeoutSeconds: parseInt(document.getElementById('timeoutSeconds').value),
                payload: document.getElementById('payload').value || null
            };
            
            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskData)
                });
                
                if (response.ok) {
                    document.getElementById('createMessage').innerHTML = 
                        '<div class="success">‚úÖ Task created successfully!</div>';
                    document.getElementById('createTaskForm').reset();
                    document.getElementById('priority').value = 5;
                    document.getElementById('timeoutSeconds').value = 300;
                    loadAllTasks();
                } else {
                    const error = await response.text();
                    document.getElementById('createMessage').innerHTML = 
                        `<div class="error">‚ùå Error: ${error}</div>`;
                }
            } catch (error) {
                console.error('Error creating task:', error);
                document.getElementById('createMessage').innerHTML = 
                    '<div class="error">‚ùå Error creating task</div>';
            }
        });
        
        // Initialize
        loadAllTasks();
        loadStatistics();
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadStatistics();
        }, 30000);
    </script>
</body>
</html>
